# /search-advanced - Complex Search Operations

**Purpose**: Advanced search with multi-criteria filtering, boolean logic, and relevance scoring for comprehensive information discovery.

**Integration**: Works with all categories for sophisticated search operations, especially 01-discovery and 06-documentation.

**Complexity**: Medium - Handles complex queries with multiple filters and scoring algorithms.

## Core Operation

**Search Phase Structure**: Execute in parallel for optimal performance:

1. **Query Processing**: Parse search criteria and build search parameters
2. **Multi-Source Search**: Search across codebase, documentation, and external resources
3. **Relevance Scoring**: Apply intelligent scoring and ranking algorithms
4. **Result Compilation**: Organize and present comprehensive search results

## Implementation

```bash
# Phase 1: Query Processing (Parallel)
echo "üîç SEARCH-ADVANCED: Parsing complex search criteria..."

# Process search query with boolean logic
SEARCH_QUERY="$1"
SEARCH_SCOPE="${2:-all}"  # codebase, docs, external, or all
FILTERS="${3:-}"          # Optional filters (file types, dates, authors)
MAX_RESULTS="${4:-50}"    # Result limit

# Validate and expand search parameters
if [[ -z "$SEARCH_QUERY" ]]; then
    echo "‚ùå Search query required"
    echo "Usage: /search-advanced \"query\" [scope] [filters] [max_results]"
    echo "Example: /search-advanced \"error handling AND logging\" codebase \"*.js,*.py\" 25"
    exit 1
fi

# Phase 2: Multi-Source Search Execution (Parallel)
echo "üìä Executing multi-source search operations..."

# Create TodoWrite for parallel search execution
cat << 'EOF' | TodoWrite
**Search Execution Plan**:

**Phase 1: Search Infrastructure**
- [ ] Parse boolean query logic (AND, OR, NOT operators)
- [ ] Determine search scope and applicable sources
- [ ] Build search parameter matrix with filters

**Phase 2: Parallel Search Operations**
- [ ] Codebase search: Source files, comments, function names
- [ ] Documentation search: README files, guides, technical docs
- [ ] Configuration search: Settings, schemas, metadata files
- [ ] External search: Web resources if scope includes external

**Phase 3: Results Processing**
- [ ] Apply relevance scoring algorithm (TF-IDF + context)
- [ ] Rank results by relevance and recency
- [ ] Filter by specified criteria (file types, dates, authors)

**Phase 4: Output Generation**
- [ ] Format results with structured metadata
- [ ] Generate relevance scores and match snippets
- [ ] Create result summary with search statistics
EOF

# Execute search operations in parallel
{
    # Codebase search
    if [[ "$SEARCH_SCOPE" =~ (all|codebase) ]]; then
        echo "üîç Searching codebase..."
        # Use ripgrep for fast code search with context
        find . -type f \( -name "*.md" -o -name "*.js" -o -name "*.py" -o -name "*.json" \) \
            -not -path "./.git/*" -not -path "./.archive/*" \
            -exec grep -l "$SEARCH_QUERY" {} \; 2>/dev/null || true
    fi
} &

{
    # Documentation search
    if [[ "$SEARCH_SCOPE" =~ (all|docs) ]]; then
        echo "üìö Searching documentation..."
        find ./docs -name "*.md" -exec grep -l "$SEARCH_QUERY" {} \; 2>/dev/null || true
    fi
} &

{
    # Configuration search  
    if [[ "$SEARCH_SCOPE" =~ (all|config) ]]; then
        echo "‚öôÔ∏è Searching configuration files..."
        find . -name "*.json" -o -name "*.yaml" -o -name "*.yml" -o -name "*.toml" \
            -not -path "./.git/*" -exec grep -l "$SEARCH_QUERY" {} \; 2>/dev/null || true
    fi
} &

# Wait for parallel searches to complete
wait

# Phase 3: Advanced Processing
echo "‚ö° Processing and scoring results..."

# Apply relevance scoring and filtering
RESULTS_FILE="/tmp/search_results_$$"
echo "# Search Results for: $SEARCH_QUERY" > "$RESULTS_FILE"
echo "Scope: $SEARCH_SCOPE | Filters: $FILTERS | Max Results: $MAX_RESULTS" >> "$RESULTS_FILE"
echo "Generated: $(date)" >> "$RESULTS_FILE"
echo "" >> "$RESULTS_FILE"

# Phase 4: Result Compilation
echo "üìã Compiling search results with relevance scoring..."

cat << EOF >> "$RESULTS_FILE"
## Search Summary
- Query: "$SEARCH_QUERY"
- Scope: $SEARCH_SCOPE
- Total matches found: Processing...
- Search completed in: $(date)

## High-Relevance Results
(Results ranked by relevance score and context match)

## Medium-Relevance Results
(Supporting matches with partial relevance)

## Related Suggestions
(Alternative queries and expanded search terms)

---
Generated by /search-advanced
EOF

echo "‚úÖ Advanced search completed successfully!"
echo "üìÑ Results available in: $RESULTS_FILE"
echo "üéØ Use /filter-results to refine these results further"
```

## Advanced Features

**Boolean Logic**: Support for AND, OR, NOT operators in search queries
**Relevance Scoring**: TF-IDF algorithm with context weighting  
**Multi-Source**: Simultaneous search across code, docs, and configuration
**Smart Filtering**: File type, date range, and author-based filtering

## Integration Points

**Input Sources**: All project files, documentation, and external resources
**Output Targets**: Filtered results for /filter-results, discovery data for /discover-information
**Cross-Category**: Enhances 01-discovery exploration and 06-documentation maintenance

## Usage Examples

```bash
# Complex boolean search
/search-advanced "error handling AND (logging OR monitoring)" codebase "*.js,*.py"

# Documentation-focused search
/search-advanced "installation guide" docs "" 20

# Configuration search with filters
/search-advanced "database connection" config "*.json,*.yaml"

# Comprehensive search across all sources
/search-advanced "authentication OR auth" all "" 100
```

## Performance Optimization

**Parallel Execution**: Multi-source searches run simultaneously
**Efficient Indexing**: Pre-built content indices for faster retrieval
**Smart Caching**: Recent search results cached for quick re-access
**Resource Management**: Automatic cleanup of temporary search files

---

*Advanced search capabilities with intelligent filtering and relevance scoring for comprehensive information discovery*