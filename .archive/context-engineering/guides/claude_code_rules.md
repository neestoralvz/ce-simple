# Reglas de Gobernanza para Claude Code

**Estas reglas deben seguirse en todo momento.**

Documento que define principios operativos obligatorios para todas las instancias de IA, garantizando comportamiento consistente, ejecuci√≥n robusta y colaboraci√≥n segura en todas las tareas y servicios.

---

## Est√°ndares de Calidad de C√≥digo

### Manejo de Errores
- **Implementa manejo estructurado de errores** con modos de falla espec√≠ficos
- **Verifica precondiciones** antes de ejecutar operaciones cr√≠ticas o irreversibles
- **Incluye mecanismos de timeout y cancelaci√≥n** para operaciones de larga duraci√≥n

### Documentaci√≥n de C√≥digo
- **Cada funci√≥n debe incluir un docstring** conciso y orientado al prop√≥sito
- **Verifica existencia y permisos** antes de operaciones de archivos y rutas
- **Valida entradas** antes del procesamiento cr√≠tico

### Principios de Implementaci√≥n
```python
# ‚úÖ Ejemplo correcto
def process_data(file_path: str) -> dict:
    """
    Procesa datos del archivo especificado.
    
    Args:
        file_path: Ruta al archivo de datos
        
    Returns:
        Diccionario con datos procesados
        
    Raises:
        FileNotFoundError: Si el archivo no existe
        PermissionError: Si no hay permisos de lectura
    """
    if not os.path.exists(file_path):
        raise FileNotFoundError(f"Archivo no encontrado: {file_path}")
    
    if not os.access(file_path, os.R_OK):
        raise PermissionError(f"Sin permisos de lectura: {file_path}")
    
    # Procesamiento con timeout
    with timeout(30):
        return _process_file_content(file_path)
```

---

## Protocolos de Documentaci√≥n

### Sincronizaci√≥n y Consistencia
- **Documentaci√≥n sincronizada** con cambios de c√≥digo‚Äîsin referencias obsoletas
- **Jerarqu√≠as de encabezados consistentes** en archivos Markdown
- **Snippets de c√≥digo ejecutables** y probados que reflejen casos de uso reales

### Estructura Obligatoria
Cada documento debe incluir claramente:
1. **Prop√≥sito** - ¬øPara qu√© sirve?
2. **Uso** - ¬øC√≥mo se utiliza?
3. **Par√°metros** - ¬øQu√© entradas requiere?
4. **Ejemplos** - Casos pr√°cticos de implementaci√≥n

### Claridad T√©cnica
- **T√©rminos t√©cnicos explicados** inline o enlazados a definici√≥n can√≥nica
- **Ejemplos ejecutables** que funcionen sin modificaciones
- **Referencias actualizadas** sin enlaces rotos

---

## Reglas de Gesti√≥n de Tareas

### Definici√≥n de Tareas
- **Tareas claras, espec√≠ficas y accionables**‚Äîevita ambig√ºedad
- **Asignaci√≥n expl√≠cita** de agente responsable con etiqueta
- **Tareas complejas divididas** en subtareas at√≥micas y rastreables

### Gesti√≥n y Seguimiento
- **Sin conflictos** con comportamiento validado del sistema existente
- **Revisi√≥n obligatoria** para tareas relacionadas con seguridad
- **Actualizaci√≥n de estado** en archivo compartido de tareas
- **Dependencias expl√≠citamente declaradas** entre tareas

### Escalaci√≥n
**Los agentes deben escalar** tareas ambiguas, contradictorias o sin alcance definido para clarificaci√≥n.

---

## Directrices de Cumplimiento de Seguridad

### Protecci√≥n de Credenciales
- ‚ùå **Credenciales hardcodeadas estrictamente prohibidas**
- ‚úÖ **Usar mecanismos de almacenamiento seguro**

### Validaci√≥n de Entradas
```python
# ‚úÖ Validaci√≥n correcta
def validate_input(data: str) -> str:
    """Valida y sanitiza entrada de usuario."""
    if not isinstance(data, str):
        raise TypeError("Entrada debe ser string")
    
    # Sanitizar entrada
    sanitized = html.escape(data.strip())
    
    # Validar longitud
    if len(sanitized) > MAX_INPUT_LENGTH:
        raise ValueError("Entrada excede longitud m√°xima")
    
    return sanitized
```

### Operaciones Seguras
- **Evita eval, llamadas shell no sanitizadas** o vectores de inyecci√≥n de comandos
- **Principio de menor privilegio** para operaciones de archivos y procesos
- **Log de operaciones sensibles** excluyendo valores de datos sensibles
- **Verificaci√≥n de permisos** antes de acceder servicios o rutas protegidas

---

## Requisitos de Ejecuci√≥n de Procesos

### Logging y Monitoreo
- **Log todas las acciones** con severidad apropiada (INFO, WARNING, ERROR)
- **Reportes de error claros** y legibles para humanos
- **Indicadores de progreso** para tareas de larga duraci√≥n

### Gesti√≥n de Recursos
- **Respetar l√≠mites de recursos** del sistema (memoria, CPU)
- **L√≥gica de reintentos** con backoff exponencial y l√≠mites de falla
- **Checkpoints** para operaciones extensas

```python
# ‚úÖ Ejemplo de retry con backoff
import time
from functools import wraps

def retry_with_backoff(max_retries=3, base_delay=1):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_retries - 1:
                        raise
                    delay = base_delay * (2 ** attempt)
                    logging.warning(f"Intento {attempt + 1} fall√≥: {e}. Reintentando en {delay}s")
                    time.sleep(delay)
        return wrapper
    return decorator
```

---

## Principios Operativos Fundamentales

### Integridad de Datos
- **Nunca usar datos mock, fallback o sint√©ticos** en tareas de producci√≥n
- **Actuar basado en evidencia verificable**, no suposiciones
- **Decisiones rastreables** a logs, datos o archivos de configuraci√≥n

### Validaci√≥n y Testing
- **L√≥gica de manejo de errores** dise√±ada con principios test-first
- **Validaci√≥n expl√≠cita de precondiciones** antes de operaciones destructivas o de alto impacto
- **Evidencia verificable** para todas las decisiones

---

## Principios de Filosof√≠a de Dise√±o

### KISS (Keep It Simple, Stupid)
- ‚úÖ **Soluciones directas** y f√°ciles de entender
- ‚ùå **Evita sobre-ingenier√≠a** o abstracci√≥n innecesaria
- üéØ **Prioriza legibilidad** y mantenibilidad del c√≥digo

### YAGNI (You Aren't Gonna Need It)
- ‚úÖ **Solo requisitos inmediatos** y entregables
- ‚ùå **No agregues caracter√≠sticas especulativas** a menos que sea expl√≠citamente requerido
- üéØ **Minimiza deuda t√©cnica** a largo plazo

### Principios SOLID

| Principio | Descripci√≥n | Aplicaci√≥n |
|-----------|-------------|------------|
| **Single Responsibility** | Cada m√≥dulo/funci√≥n hace una sola cosa | Una funci√≥n = un prop√≥sito claro |
| **Open-Closed** | Abierto para extensi√≥n, cerrado para modificaci√≥n | Usar interfaces y herencia |
| **Liskov Substitution** | Clases derivadas sustituibles por base | Mantener contratos de interfaz |
| **Interface Segregation** | Interfaces espec√≠ficas vs generales | M√∫ltiples interfaces peque√±as |
| **Dependency Inversion** | Depender de abstracciones, no implementaciones | Inyecci√≥n de dependencias |

---

## Directrices de Extensi√≥n del Sistema

### Nuevos Agentes
- **Conformidad con interfaces existentes** de logging y estructuras de tareas
- **Funciones utilitarias** probadas unitariamente y revisadas por pares
- **Cambios de configuraci√≥n** reflejados en manifiesto del sistema con sellos de versi√≥n

### Compatibilidad
- **Mantener compatibilidad hacia atr√°s** a menos que est√© justificado y documentado
- **Evaluaci√≥n de impacto en rendimiento** para todos los cambios
- **Versionado adecuado** para cambios significativos

---

## Procedimientos de Aseguramiento de Calidad

### Revisi√≥n Obligatoria
**Un agente revisor debe revisar** todos los cambios que involucren:
- üîí Seguridad
- ‚öôÔ∏è Configuraci√≥n del sistema  
- üë• Roles de agentes

### Est√°ndares de Salida
- **Documentaci√≥n revisada** por claridad, consistencia y correcci√≥n t√©cnica
- **Salida orientada al usuario** (logs, mensajes, errores) clara, no t√©cnica y accionable
- **Mensajes de error** que sugieran rutas de remediaci√≥n o pasos diagn√≥sticos
- **Plan de rollback** para todas las actualizaciones importantes

---

## Reglas de Testing y Simulaci√≥n

### Cobertura de Testing
- **L√≥gica nueva incluye** pruebas unitarias y de integraci√≥n
- **Datos simulados claramente marcados** y nunca promovidos a producci√≥n
- **Todas las pruebas pasan** en pipelines de integraci√≥n continua
- **Cobertura de c√≥digo superior** a umbrales definidos (ej. 85%)

### Gesti√≥n de Testing
```python
# ‚úÖ Ejemplo de test structure
import unittest
from unittest.mock import patch, MagicMock

class TestProcessData(unittest.TestCase):
    def setUp(self):
        """Configuraci√≥n para cada test."""
        self.test_data_path = "/tmp/test_data.json"
        self.mock_data = {"test": "data"}
    
    def test_process_valid_file(self):
        """Test con archivo v√°lido."""
        with patch('os.path.exists', return_value=True), \
             patch('os.access', return_value=True):
            result = process_data(self.test_data_path)
            self.assertIsInstance(result, dict)
    
    def test_process_missing_file(self):
        """Test con archivo faltante."""
        with patch('os.path.exists', return_value=False):
            with self.assertRaises(FileNotFoundError):
                process_data(self.test_data_path)
    
    def tearDown(self):
        """Limpieza despu√©s de cada test."""
        # Limpiar archivos temporales
        pass
```

### Logging de Testing
- **Resultados de test** en logs separados, no logs de producci√≥n
- **Pruebas de regresi√≥n** definidas y ejecutadas para actualizaciones de alto impacto
- **Datos de test marcados** claramente para evitar confusi√≥n con producci√≥n

---

## Seguimiento de Cambios y Gobernanza

### Documentaci√≥n de Cambios
- **Cambios de configuraci√≥n o reglas** documentados en manifiesto del sistema y changelog
- **Registro de fuente, timestamp y justificaci√≥n** al modificar assets compartidos
- **Incremento de versi√≥n interna** del sistema cuando sea aplicable

### Planes de Contingencia
- **Plan de rollback o deshacer** definido para cada cambio importante
- **Trails de auditor√≠a preservados** para todas las operaciones que modifican tareas
- **Versionado sem√°ntico** para cambios cr√≠ticos

### Ejemplo de Changelog
```markdown
## [v2.1.0] - 2024-07-09

### Agregado
- Nuevo sistema de validaci√≥n de entradas
- Timeout configurable para operaciones de larga duraci√≥n

### Cambiado
- Mejorado manejo de errores en processing de archivos
- Actualizada documentaci√≥n de APIs

### Corregido
- Resuelto memory leak en operaciones concurrentes

### Seguridad
- Fortalecida validaci√≥n de permisos de archivos
```

---

## M√©tricas de Cumplimiento

**Indicadores de √©xito para estas reglas:**

- üéØ **100% de funciones** con docstrings apropiados
- üîí **0 credenciales hardcodeadas** en codebase
- üìä **>85% cobertura de c√≥digo** en tests
- ‚ö° **<5% fallos** en operaciones cr√≠ticas
- üìù **Documentaci√≥n actualizada** en <24h de cambios de c√≥digo
- üîÑ **Planes de rollback** para 100% de cambios mayores

**Herramientas de monitoreo recomendadas:**
- Linting autom√°tico (pylint, flake8)
- An√°lisis de seguridad (bandit, safety)
- Cobertura de tests (coverage.py)
- Documentaci√≥n autom√°tica (sphinx, mkdocs)